# Chapter 10 Odoo 12 Development Background View - Designing the User Interface

This article is the tenth in the series of [The best free ERP system Odoo 12 development manual](README.md).

In this article, you will learn how to create a graphical interface for users to interact with the book application. We will understand the differences between different view types and widgets, and how to use them to provide a better user experience.

The main contents of this article are:

- Menu Item
- Window Actions
- Form view structure
- Field
- Buttons and Smart Buttons
- Dynamic view elements
- List View
- Search View
- Other view types



## Development Preparation

We will continue to use the library_checkout plugin module, which already has a model layer, and now needs a view layer to implement the user interface. The code in this article is based on Chapter 8 [Odoo 12 Development of Business Logic - Business Process Support] (8.md), and the relevant code can be found in [GitHub Repository] (source-code/chapter8). After this chapter is completed, the code can also be found in [GitHub Repository] (source-code/chapter10).

## Menu Items

The entry point to the user interface is the menu item, which forms a hierarchical structure, with the top item being the application, and the next level being the main menu for each application. You can also add deeper submenus. The actionable menu is associated with the window action, which tells the client what action to perform after clicking the menu item.

Menu items are stored in the ir.ui.menu model and can be viewed through the Settings > Technical > User Interface > Menu Items menu.

The library_app module creates a top-level menu for books, and the library_checkout plugin module adds menu items for borrowing and borrowing stages. In the library_checkout/views/library_menu.xml file, the XML code for the borrowing menu item is as follows:

```
    <menuitem id="menu_library_checkout"
        name="Checkout"
        action="action_library_checkout"
        parent="library_app.menu_library" />
```

There is a <menuitem> shortcut element that provides a shorthand way to define menu items, which is more convenient than the native <record model="ir.ui.view"> element. The attributes used above are:

- name is the title of the menu item displayed in the user interface
- action is the XML ID of the window action to be run when the menu item is clicked
- parent is the XML ID of the parent menu item. In this case, the parent item is created by another module, so we use the full XML ID, <module>.<XML ID> to reference it.

The following properties are also available:

- sequence sets a number to sort the menu items when displaying them, such as sequence="10"
- groups is a comma separated list of XML IDs of security groups that can access the menu item, such as groups="library_app.library_group_user, library_app.library_group_manager"
- web_icon is the icon of the menu item, which is only used for the top-level menu items of the enterprise version, such as web_icon="library_app,static/description/icon.png"

## Window Actions

A window action is an instruction to a GUI client, usually a menu item or a button in a view. It tells the GUI which model to act on and which view to display. These actions can filter available records by domain filters, set default values, and filter from context attributes. Window actions are stored in the ir.actions.act_window model and can be viewed through the Settings > Technical > Actions > Window Actions menu.

In the library_checkout/views/library_menu.xml file, we can find the window actions used in the borrow menu item, which we need to modify to enable the view type that will be added in this article:

```
    <act_window id="action_library_checkout"
        name="Checkouts"
        res_model="library.checkout"
        view_mode="tree,form,activity,calendar,graph,pivot" />
```

Window actions are usually created using the <act_window> shortcut tag as shown above. Here we change "tree, form" to a larger list of "tree, form, activity, calendar, graph, pivot". The window action properties used above are:

- name is the title displayed in the view opened by the action
- res_model is the identifier of the target model
- view_mode is a comma separated list of available view types. The first entry is the default view when it is opened.

Window operations have some other properties:

- target: If set to new, the view will be opened in a pop-up dialog window, for example, target="new". The default value is current, which opens the view in the main content area row.
- context: Sets context information for the target view, such as setting default values ​​or enabling filters, for example, context="{'default_user_id': uid}".
- domain: is a domain expression that forces filtering of records that can be browsed in the open view, for example domain="[('user_id', '=', uid)]".
- limit: The number of records displayed per page in the list view, for example, limit="80".

After making these changes, when you select the Checkouts menu item and browse the corresponding list view, some buttons will be added in the upper right corner after the list and form buttons. But they cannot be used before we create the corresponding views. This article will learn them one by one. Window operations can also be used in the Action menu button above the list and form views, next to the Fitlers button. To use this, we need to add the following two attributes to the element:

- src_model sets the model that the Action acts on, for example, src_model="library.checkout"
- multi="true" enables the Action in list view as well, so that it can act on multiple selected records. Otherwise it is only available in form view and can only be applied to one record at a time.

Supplement: When you open the borrowing form, you will be prompted with Insufficient fields for Calendar View!. Before writing the calendar view, it is best to delete the calendar in the view mode to see the effect.

## Form view structure

The form view follows either a simple layout or a business document layout similar to a paper document. We will learn how to design these business document layouts and use the available elements and components. To do this, we will review and expand the book borrowing form created in Chapter 8 [Odoo 12 Development of Business Logic - Business Process Support] (8.md).

### Business Document View

A lot of data recorded in business applications can be presented as paper documents. Form views can mimic these paper documents to provide a more intuitive user interface. For example, in our application, a checkout can be viewed as filling out a piece of paper, and we will write a form view that follows this design. Edit the library_checkout/views/chceckout_view.xml file and modify the form view record to carry the basic skeleton of the business document view:

```
    <record id="view_form_checkout" model="ir.ui.view">
        <field name="model">library.checkout</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <!--The following is only for viewing the effect-->
                    <field name="state" widget="statusbar" clickable="True" />
                </header>
                <sheet>
...
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers" />
                    <field name="activity_ids" widget="mail_activity" />
                    <field name="message_ids" widget="mail_thread" />
                </div>
            </form>
        </field>
    </record>
```

The view name is optional and will be automatically generated if not specified. For simplicity, the above uses this and omits the <field name="name"> element in the view record. You can see that business document views usually use three major areas:

- Header status bar
- Sheet main content
- Bottom communication area, also known as chatter

The communication area at the bottom uses the social network components provided by the mail plugin module. To use these, our model needs to inherit mail.thread and mail.activity.mixin, as shown in Chapter 8 [Business Logic - Business Process Support for Odoo 12 Development](8.md).

![Odoo 12 Documentation View](http://alanhou.org/homepage/wp-content/uploads/2019/01/header-chatter.jpg)

### Header

The header is usually used for the life cycle or steps that the document has gone through, and also contains relevant action buttons. These buttons are normal form buttons, and the most important next step can be highlighted.

### Header Button

In the <header> section of the edit form view, we add a button to make it easier to set the returned loan to done:

```
                <header>
                    <field name="state" invisible="True" />
                    <button name="button_done"
                        string="Return Books"
                        attrs="{'invisible':
                            [('state', 'in', ['new', 'done'])]}"
                        class="oe_highlight" />
                </header>
```

Here we have added a Return Books button to the header that calls the button_done model method when clicked. Note that class="oe_highlight" can be used to highlight actions to the user. For example, when there are several buttons to choose from, we can highlight the main action or the "More" action to be performed next. attrs is used to hide the button in the New and Done states. The condition to achieve this uses the state field, which will not be displayed in the form. For the condition to work, we need to load all the values ​​used in the web client. We don't plan to show the state field to the end user, so we add it as an invisible field using invisible.

> ℹ️Fields used in domain or attrs expressions must be loaded in the view, scoped to their <field> elements. If the field is not visible to the user, it must be loaded as an invisible field element.

In this example, we use the state field. The same effect can be achieved through the states field attribute. Although it is not as flexible as the attrs attribute, it is more concise. You can replace the attrs section with the following code:

```
<button name="button_done"
    type="object"
    string="Returned"
    states="open,cancel"
    class="oe_highlight" />
```

The visibility of attrs and states elements can also be used for other view elements, such as fields. This article will discuss this in depth later. To make the button work, we also need to implement the calling method. Add the following method to the borrowing class in the library_checkout/models/library_checkout.py file:

```
    def button_done(self):
        Stage = self.env['library.checkout.stage']
        done_stage = Stage.search(
            [('state', '=', 'done')],
            limit=1)
        for checkout in self:
            checkout.stage_id = done_stage
        return True
```

This method first looks for records in the done stage to use, and then for each record in the self recordset, sets its stage_id value to the done stage.

![Odoo 12 Highlight Button](http://alanhou.org/homepage/wp-content/uploads/2019/01/highlight-button.jpg)

### Stage Pipeline

Next, we add a status bar component to the header to show the stage the document is in. From a code level, we use the <field> element of the stage_id field of the statusbar component:

```
                <header>
...
                    <field name="stage_id"
                        widget="statusbar"
                        clickable="True"
                        options="{'fold_field': 'fold'}" />
                </header>
```

This adds a stage pipeline component to the header, which uses a statusbar component on a field that represents the current point in the document's lifecycle. Usually this is a status option field or a stage many-to-one field. These two types of fields appear many times in the Odoo core module. The clickable attribute allows the user to change the document stage by clicking on the status bar. It is usually necessary to turn it on, but sometimes it is not, such as when you need more control over your work and require the user to only use the available action buttons to proceed to the next step. This approach allows specific validation when switching between stages.

When using the statusbar component for stages, we can hide (fold) rarely used stages in the More stage group. The corresponding stage model must have a flag to configure the stage to be hidden, usually named fold. The statusbar component then uses the options attribute to provide this field name to the fold_field option, as shown in the above code.

![Odoo 12 stage fold](http://alanhou.org/homepage/wp-content/uploads/2019/01/stage-fold.jpg)

### Using states instead of phases

Stage is a many-to-one field that uses a model to set the progress step. Therefore, end users can dynamically configure it to suit their specific business processes and support the perfect display of the dashboard. We will use state in book borrowing.

A state is a selection list containing fairly stable steps in a process, such as New, In Process, and Complete. It cannot be configured by the end user, and because it is static, it is easier to use in business logic. There is even special support for states in view fields: the state field property is only available to the user if the record is in a specific state.

> ℹ️Stages were introduced later than states. The two now coexist, and the trend in the Odoo core is to use stages instead of states. But as mentioned before, states still provide some features that stages do not have.

We can get the best of both worlds by mapping the stages to states. In the borrowing model, we do this by adding a state field to the borrowing stage, and the borrowing document uses the state through an associated field. In models that use states instead of stages, we can also use the progress bar pipeline. In this case, to list the state in the progress bar, we need to use the statusbar_visible attribute instead of the fold_field option. The specific code is as follows:

```
                    <field name="state"
                        widget="statusbar"
                        clickable="True"
                        statusbar_visible="draft,open,done" />
```

Note that this cannot be used in our actual book lending project because it is stage-driven rather than state-driven.

![Odoo 12 status](http://alanhou.org/homepage/wp-content/uploads/2019/01/odoo-state.jpg)

### Documentation Form

The form canvas is the main area of ​​the form, where the actual data elements are placed. The design is similar to a real paper document. Usually these records in Odoo are also called documents. Usually the document form structure contains the following areas:

- Document title and subtitle in the upper left corner
- Upper right button area
- Other document header fields
- Bottom note area to organize additional fields into tabs or pages

The document rows are usually on the first page in the notes area, and after the form, there is usually a chatter component with document subscribers, discussion messages, and activity planning. Let's take a look at each of these areas.

Supplement: Regarding the translation of sheet, Alan understands that sheet only means single (document), but out of writing habits, we always use the word "sheet".

#### Title and subtitle

Fields outside an element do not automatically have labels to render them. This is true for the title element, so the element should be used to render it. Although it takes extra work, the benefit is greater flexibility in controlling the display of the labels. Regular HTML, including CSS style elements, can be used to beautify the title. Generally, the title is placed in the oe_title class. The following is an expanded <sheet> element, which contains the title and some additional fields such as the subtitle:

```
                <sheet>
                    <field name="member_image" widget="image" class="oe_avatar" />
                    <div class="oe_title">
                        <label for="member_id" class="oe_edit_only" />
                        <h1><field name="member_id" /></h1>
                        <h3>
                            <span class="oe_read_only">By </span>
                            <label for="user_id" class="oe_edit_only" />
                            <field name="user_id" class="oe_inline" />
                        </h3>
                    </div>
                    <!-- More elements will be added from here... -->
                </sheet>
```

Here you can see that we use the common HTML elements div, span, h1 and h3. The <label> element allows us to control when and where the field label is displayed. The for attribute identifies the field to get the label file. You can also use the string attribute to provide specific text for the label. In this example, the class="oe_edit_only" attribute is also used to make it available only in edit mode.

We can also include a display image next to the title in the upper left corner of the form. It is used in the form view of models such as parnter or product. As an example, we added a member_image field before the title area, which uses the image component widget="image" and a specific CSS class class="oe_avatar". This field has not been added to the model yet, so let's add it. We use the associated field to display the member's image in the borrowing document. Edit the library_checkout/models/library_checkout.py file and add the following field to the borrowing class:

```
member_image = fields.Binary(related='member_id.partner_id.image')
```

![Odoo 12 Image-Title](http://alanhou.org/homepage/wp-content/uploads/2019/01/title-image-widget.jpg)

### Form content grouping

The main content of the form should be organized using the <group> tag. The <group> tag inserts two columns into the canvas. By default, labels are displayed next to the fields in these columns, thus occupying two more columns. The field plus the label will occupy one row, and the next field and label will be placed in another row, vertically. A common layout for Odoo forms is to have two columns of labeled fields side by side. To achieve this, we just need to add two <group> tags nested at the top.

Continue to modify the form view and add the following code after the main content area title <div>:

```
                    <group name="group_top">
                        <group name="group_col1">
                            <field name="user_id" />
                            <field name="checkout_date" />
                        </group>
                        <group name="group_col2">
                            <field name="state" />
                            <field name="closed_date" />
                        </group>
                    </group>
```

It is a good coding practice to assign a name to the group tag so that it is easier to refer to them when inherited from other modules. You can also set a string attribute, which once set will be displayed as the title of the section.

> ℹ️ **Changes in Odoo 11**
> string properties cannot be used as anchors for inheritance because they are translated before inheritance is applied. Use the name property instead.

Within a group, the <newline> element forces a new line, with the next element rendered in the first column of the group. Additional section titles can be added via the <separator> element within the group, which also renders the title tag if it has a string attribute. To have more control over the layout of elements, we can use the col and colspan attributes.

The col attribute can be used in the <group> element to define the number of columns contained. As mentioned before, the default is two columns, but it can be changed to any other number. Even numbers are better because by default each added field will occupy two columns: the field label and the field value. In the following code we use colspan="2" to display 4 fields in two columns in one group:

```
                    <group name="group_top">
                        <group name="group_col1"
                            col="4"
                            colspan="2"
                            string="Group 1">
                            <field name="user_id" />
                            <field name="state" />
                            <field name="checkout_date" />
                            <field name="closed_date" />
                        </group>
                        <group name="group_col2" string="Group2" />
                    </group>
```

Above we use the string attribute to add a title to the group, to make it easier to see where the group is. Note that the order of the fields is different, they are first from left to right, then from top to bottom. The <group> element can use the colspan attribute to set the specific number of columns it occupies. The default is two columns, just like the labeled field. You can modify the col and colspan values ​​in the above code to see different effects in the form. For example, what does col="6" colspan="4" look like? You can try it (see the figure below).

![Odoo 12 colspan example](http://alanhou.org/homepage/wp-content/uploads/2019/01/col-colspan.jpg)

### Tabbed notebooks

Another way to organize content is with the notebook element, a container with multiple tabbed sections called pages. They can be used to hide less frequently used content when not in use, or to organize a large number of fields by topic.

We will add a notebook element with a list of borrowed books to the borrowing form. Add the following code after the previous <group name="group_top"> element:

```
                    <notebook>
                        <page string="Borrowed Books" name="page_lines">
                            <field name="line_ids" />
                        </page>
                    </notebook>
```

In this example, the notebook has only one page. To add more, we need to add more <page> blocks inside the <section> element. The page canvas does not render field labels by default. To display them, place the fields in a <group> block like the form main canvas. In this example, we added a one-to-many field line_ids to the page. We already have a page title, so no label is needed. page supports the following attributes:

- string: Title of the tab (required)
- attrs: dictionary mapping invisible attributes to expressions
- accesskey: HTML access key

![Odoo 12 Tabbed Notebook](http://alanhou.org/homepage/wp-content/uploads/2019/01/tabbed-notebook.jpg)

## Fields

View fields have a number of attributes available to them. Most of these get their values ​​from the model definition, but can be overridden in the view. Here's a quick look at the available attributes for a field:

- name identifies the name of the field in the database
- string is used for label text that you want to override the label text in the model
- help is the tooltip text displayed when the mouse hovers over the field, which allows us to override the help text provided in the model definition
- placeholder is the hint text displayed in the field
- widget allows us to override the default widget of the field. We will talk about the available widgets in a moment.
- options is a JSON data structure with additional data for the component. The value varies depending on the support of each component.
- class is the CSS class used for the field HTML rendering
- nolabel="True" prevents automatic field labels from being displayed. Only works for fields within a <group> element, usually used with a <label for="..."> element.
- invisible="True" makes the field invisible, but the data will still be retrieved from the server and can be used in the form
- readonly="True" makes the field uneditable in the form
- required="True" makes this field required in the form

Some specific field properties are as follows:

- password="True" is used for text fields. It is displayed as a password field and the entered text is hidden.
- filename is used for binary fields, it is the name of the model field used to store the uploaded file name

### Field Tags

The <label> element can be used to fine-tune the display of field labels. An example use case would be to only display a label when the form is in edit mode:

```
<label for="name" class="oe_edit_only" />
```

When doing this, we usually also set nolabel="True" on the field if it is inside a <group> element. class="oe_edit_only" can be used to apply CSS styles so that the label is only visible in edit mode.

### Field Components

Each field type uses a default component to display in the form. However, there are alternative components that can be used. For text fields, there are the following components:

- email is used to make email text an actionable "mail-to" address
- url is used to format the text as a clickable URL
- html is used to render text as HTML content; in edit mode, it is displayed as a WYSIWYG (What You See Is What You Get) editor to format the content without using HTML code.

For numeric fields, there are the following components:

- handle is used as a sort field in the list view, showing a handle so that we can drag and drop for custom sorting
- float_time formats a floating point field as a value with hours and minutes
- monetary displays a floating point field as a monetary amount. This is used in conjunction with the currency_id field, and can also use another field name via options="{'currency_field': 'currency_id'}"
- progressbar displays a floating point value as a progress bar percentage, which is useful for showing fields as completion rates.
- percentage and percentpie components can be used for floating point fields

For association and selection fields, the following additional components are available:

- many2many_tags displays the value as a list of button tags
- many2many_checkboxes displays option values ​​as a list of checkboxes
- selection uses the selection field component for many-to-one fields
- radio displays the select field options as radio buttons
-priority displays the option field as a clickable list of stars. The options are usually numeric values.
- state_selection displays the board state selection list as a signal light. Normal states are displayed in gray, completed states are displayed in green, and other states are displayed in red.
- pdf_viewer is a binary field (introduced in Odoo 12).

> ℹ️ **Changes in Odoo 11**
> state_selection was introduced in Odoo 11 to replace kanban_state_selection. The latter was deprecated, but is still supported for backward compatibility.

### Relational fields

In the related fields, we can give the user some additional control. By default, users create new records from these fields (also known as "quick create") and open the related records form. This can be turned off using the options field attribute:

```
options="{'no_open': True, 'no_create': True}"
```

Context and domain are also field attributes and are particularly useful for relational fields. Context can define default values ​​for relational records, and domain can restrict the selectable records. A common example is to have a field depend on the value of another field to make its selections. The domain can be defined directly in the model, but can also be overridden in the view.

In to-many fields, we can also use the mode attribute to change the type of view used to display the records. The default is tree, but there are other options: form, kanban or graph. Related fields can define specific views to use within the line. These views are declared in nested view definitions within the element. For example, in a line_ids loan, we can define specific list and form views for those lines:

```
                    <notebook>
                        <page string="Borrowed Books" name="page_lines">
                            <field name="line_ids">
                                <tree>
                                    <field name="book_id" />
                                </tree>
                                <!--form>
                                    <field name="book_id" />
                                </form-->
                            </field>
                        </page>
                    </notebook>
```

The list of lines will come with the given <tree> definition. When we interact with the line, a form dialog pops up, containing the structure in the <form> definition.

> **Tip:** If you want to edit one-to-many routes directly in the list view's form popup, you should use <tree editable="top"> or <tree editable="bottom">

![Odoo 12 inline list, form view](http://alanhou.org/homepage/wp-content/uploads/2019/01/inline-tree-form.jpg)

## Buttons

Buttons support these properties:

- string is the button text label or HTML alt text when using an icon
- type is the type of operation to be performed, and has the following values:
  - object is used to call Python methods
  - action is used to run window operations
- name identifies the specific operation to be performed according to the selected type. It is either a model method name or the database ID of the window operation to be run. You can use the %(xmlid)d formula to convert the XML ID into the database ID required when loading the view.
- args is used to pass additional parameters to the method when the type is object. It must be a pure static JSON parameter added after the record ID that forms the method call parameter.
- context adds values ​​to the context, which can take effect after window operations or Python code method calls.
- confirm displays a confirmation message box before running the related operation, and the content displayed is the text assigned in the property. special="cancel" is used for wizard forms.
- icon is the icon displayed by the button. Available buttons are from the Font Awesome icon set, version 4.7.0, and should be specified through the corresponding CSS class, such as icon="fa-question". For more information, visit [Font Awesome](https://fontawesome.com/v4.7.0/icons/).

> ℹ️ **Changes in Odoo 11**
> Before Odoo 11, button icons were images from the GTK client library and were limited to images stored in addons/web/static/src/img/icons.
>
> ℹ️ **Changes in Odoo 11**
> The workflow engine has been deprecated and removed in Odoo 11. In previous versions, where workflow was supported, a button could trigger a workflow engine signal with type="workflow". The name attribute was used for the workflow signal name.

### Smart Button

It is also common to have a smart button in the upper right corner. A smart button appears as a rectangle with a data indicator that opens a window when clicked.

The UI style used in Odoo is to have a hidden box where the smart button is placed. The button box is usually the first element of the <sheet>, before the <div class="oe_title"> element (and the avatar), like this:

```
<div name="button_box" class="oe_button_box">
    <!-- Smart buttons will go here... -->
</div>
```

The container of the button is a div element with the class oe_button_box. Prior to Odoo 11.0, it might be necessary to add a class oe_right to ensure that the button box is right-aligned in the form. In our application, we will display the total number of other loans that the library member has to return in the button, and clicking the button will enter the list of these items.

So we need the member's borrowing records in the open state, excluding the current borrowing. For button statistics, we should create a calculated field to count in the borrowing class of the library_checkout/models/library_checkout.py file:

```
    num_other_checkouts = fields.Integer(
        compute='_compute_num_other_checkouts')

    def _compute_num_other_checkouts(self):
        for rec in self:
            domain = [
                ('member_id', '=', rec.member_id.id),
                ('state', 'in', ['open']),
                ('id', '!=', rec.id)]
            rec.num_other_checkouts = self.search_count(domain)
```

Next we can add a button box and add buttons to it. Above the <sheet> section, replace the button box placeholder with the following code:

```
                    <div name="button_box" class="oe_button_box">
                        <button class="oe_stat_button"
                            icon="fa-tasks"
                            help="Other checkouts pending return."
                            type="action"
                            name="%(action_other_checkouts_button)d"
                            context="{'default_member_id': member_id}">
                            <field string="To Return"
                                name="num_other_checkouts"
                                widget="statinfo" />
                        </button>
                    </div>
```

The button element itself is a container with fields for displaying data. These data are normal fields using the statinfo specific component. The fields are usually calculated fields defined in the model. In addition to fields, static text can also be used in buttons, such as <div>Other Checkouts</div>. The number of other pending checks is displayed in the num_other checkouts field in the button definition.

The smart button must have the class="oe_stat_button" CSS style and should have an icon using the icon attribute. It has a type="action" which means that the window action identified by the name attribute will be run when the button is clicked. The %(action_other_checkouts_button)d expression returns the database ID of the action to be run.

When the button is clicked, we want to check out other checkouts for the current member. This can be achieved with the action_other_checkouts_button window action. The action opens a book checkout list using the appropriate domain filter. Actions and corresponding domain filters are processed outside the form context and cannot access form data. Therefore the button must set the current member_id in the context for the window action to use later. The window action used must be defined before the form, so we should add the following code at the very top of the root element <odoo> of the XML file:

```
    <act_window id="action_other_checkouts_button"
        name="Open Other Checkouts"
        res_model="library.checkout"
        view_mode="tree,form"
        domain="[('member_id', '=', default_member_id),
            ('state', 'in', ['open']),
            ('id', '!=', active_id)]"/>
```

Notice how we use the default_member_id context key in the domain filter. This key also sets the default value for the member_id field when clicking the button link to create a new task. The domain filter also requires the current ID. This does not need to be explicitly set in the context, as the web client automatically sets it in the active_id context key.

![Odoo 12 Smart Button](http://alanhou.org/homepage/wp-content/uploads/2019/01/smart-button.jpg)

Here are the properties you can add to a smart button for your reference:

- class="oe_stat_button" renders a rectangle instead of a normal button
- icon Select an icon from the Font Awesome icon set to use. Visit [Font Awesome](http://fontawesome.io) to see what icons are available.
- type and name are the button type and the name of the action to be triggered. For smart buttons, the type is usually action, which specifies the window action, and the name is the ID of the action to be performed. The real database ID should be passed in, so we use the formula to convert the XML ID to a database ID: "%(actionxmlid)d". This action should open the view with the associated records.
- string adds label text to the button, not used here because the text is already provided in the included field.
- context is used to set default values ​​for the target view, which is used for the newly created record on the view after clicking the button.
-Help displays help information when the mouse hovers over the button

## Dynamic View Elements

View elements also support some attributes that allow the view to dynamically change appearance or behavior based on field values. We can have onchange events to modify other field values ​​when editing form data, or make fields required or displayed when certain conditions are met.

### onchange event

The onchange mechanism allows me to modify other form fields when a specific field changes. For example, an onchange for a product field can set the price field to a default value when the product is modified. In older versions, the onchange event was defined at the view level, but after 8.0 it is defined directly in the model layer without any specific markup on the view. This is done by creating a model using the @api.onchange('field1', 'field2', ...) decorator to bind onchange logic to some fields. The onchange model method is discussed in detail in Chapter 8 [Business Logic - Business Process Support for Odoo 12 Development](8.md), which also contains relevant examples.

The onchange mechanism can also automatically recalculate calculated fields with instant feedback as the user types. Continuing with the product example, if the price field changes when modifying the product, it will also automatically update the calculated total amount field based on the new price.

### Dynamic properties

Some properties allow us to dynamically change the display of view elements based on the value of the record. The visibility of specific user interface elements can be easily controlled through the following properties:

- groups allows you to make an element visible based on the security groups to which the current user belongs. Only members of the specified groups can see the element. Its value should be a comma-separated list of XML IDs
- states allows you to make elements visible based on the state field of the record. Its value is a comma-separated list of states and is only valid for models with a state field.

In addition to these, we have some flexible ways to set element visibility based on expressions dynamically generated by the client. It is a special attribute attrs, whose value is a dictionary mapping the invisible attribute value and the expression result. For example, to make the closed_date field invisible in the new and open states, you can use the following code:

```
<field name="closed_date"
     attrs="{'invisible':[('state', 'in', ['new', 'open'])]}"/>
```

invisible is not only available in fields, but also in any element. For example, it can be used in notebook pages and group elements. The attrs attribute can also set values ​​for two other attributes: readonly and required. They only make sense for data fields, and they can be used to make the field editable or required. This allows us to implement some basic client-side logic, such as making a field required based on the value of another field (such as state).

## List View

At this point, it may not be necessary to introduce list views, but it has some interesting additional properties to discuss. Let's modify the library_checkout/views/checkout_view.xml file to improve the version in Chapter 8 [Odoo 12 Development of Business Logic - Business Process Support] (8.md):

```
    <record id="view_tree_checkout" model="ir.ui.view">
        <field name="name">Checkout Tree</field>
        <field name="model">library.checkout</field>
        <field name="arch" type="xml">
            <tree
                decoration-muted="state in ['done', 'cancel']"
                decoration-bf="state=='open'">
                <field name="state" invisible="True" />
                <field name="request_date" />
                <field name="member_id" />
                <field name="checkout_date" />
                <field name="stage_id" />
                <field name="num_books" sum="# Books" />
            </tree>
        </field>
    </record>
```

The row text color and font can be dynamically changed based on the result of a Python expression. This is done by taking the expression of the calculated field attribute and passing it to the decoration-NAME attribute. NAME can be bf or it for bold and italic respectively, or any other Bootstrap text context color: danger, info, muted, primary, success or warning. The [Bootstrap documentation](https://getbootstrap.com/docs/3.3/css/#helper-classes) shows examples of this.

> ℹ️ **Changes in Odoo 9**
> The decoration-NAME attribute was introduced in Odoo 9. In Odoo 8 it was used by the colors and fonts attributes.

Remember that the fields used in the expression must be declared in the <field> field so that the web client knows to get the column from the server. If you don't want to display it to the user, you should use the invisible="1" attribute. Other tree element related attributes are:

- default_order allows us to override the default order in the model. Its value is the same as the order format defined in the model.
- create, delete and edit, if set to false (lowercase letters), will disable the corresponding operations in the list view.
- editable makes the record editable directly in the list view. Available values ​​are top and bottom, indicating the position where the new record is added.

List views can contain fields and buttons, and most of the properties in forms are also available to them. In list views, numeric fields can be displayed as a summary of the corresponding column. Adding a cumulative property (sum, avg, min or max) to a field assigns it a label text of the summary value. We have added an example to the num_books field:

```
<field name="num_books" sum="# Books" /
```

The num_books field counts the number of books in each loan. It is a calculated field that we need to add to the model:

```
    num_books = fields.Integer(compute='_compute_num_books')

    @api.depends('line_ids')
    def _compute_num_books(self):
        for book in self:
            book.num_books = len(book.line_ids)
```

![Odoo 12 list view quantity accumulation](http://alanhou.org/homepage/wp-content/uploads/2019/01/list-view-sum.png)

## Search View

The available search options are defined by the <search> view type. We can choose which fields to search automatically when typing in the search box. We can also pre-set filters, which can be enabled by clicking on them, as well as pre-set grouping options in the list view. The search view for book loans can be set as follows:

```
    <record id="view_filter_checkout" model="ir.ui.view">
        <field name="model">library.checkout</field>
        <field name="arch" type="xml">
            <search>
                <field name="member_id" />
                <field name="user_id" />
                <filter name="filter_not_done"
                    string="To Return"
                    domain="[('state','=','open')]" />
                <filter name="filter_my_checkouts"
                    string="My Checkouts"
                    domain="['user_id', '=', uid]" />
                <filter name="group_user"
                    string="By Member"
                    context="{'group_by': 'member_id'}" />
            </search>
        </field>
    </record>
```

In the <search> view definition, you can see two simple elements for member_id and user_id, and when the user types in the search box, matches to these fields are displayed in the recommendation drop-down box. Then there are two pre-built filters that use domain filters. These can be selected under the Filter button below the search box. The first filter is To Return books, that is, books that are still in the open state. The second filter is the books that the current librarian is handling, filtered by the user_id of the current user (which can be obtained in the uid key of the context).

The two filters can be enabled separately and connected with the OR operator. The entire block of filters separated by the <separator /> element is connected with the AND operator.

The third filter sets only the group by context key, which tells the view to group records by a field, in this case the member_id field.

The field element can use the following attributes:

- name identifies the field to use
- string is used as label text, it replaces the default value
- operator is used to modify the default operator (default value: = for numeric fields, ilike for other field types)
- filter_domain sets the specific domain expression used for the search, providing a flexible alternative to the operator attribute. The search text is referenced in the expression via self. A simple example: filter_domain="[('name', 'ilike', self)]"
- groups allows the search to be limited to members of security groups. Its value is a comma-delimited list of XML IDs.

The filter element has the following attributes available:

- name is used as an identifier for subsequent inheritance/extension or enabling via window operations. This is not required, but it is good coding practice to include it.
- string is the label text displayed by the filter, required
- domain is the domain expression to be added to the current domain
- context is the context dictionary added to the current context. Usually group_id is used as the key and the field name used to group the records is used as the value
- groups makes the search in this field only open to members of a list of security groups (XML IDs)

![Odoo 12 search filter](http://alanhou.org/homepage/wp-content/uploads/2019/01/filter-search.jpg)

## Other view types

Form, list and search views are the most commonly used view types. But there are some other view types that can be used to design user interfaces. We are already familiar with the three basic view types mentioned above. In Chapter 11 [Odoo 12 Development of Kanban View and User-side QWeb] (11.md), the Kanban view will be introduced in detail. It will visualize records as cards and even organize them into Kanban boards by columns. Below we will learn some other view types:

- activity displays planned activities as an organized summary
- calendar displays data in calendar format based on the selected date field
- diagram shows the relationship between records, currently not used in Odoo

There are two view types for displaying cumulative data:

- graph is used for chart display
- pivot for interactive pivot tables

There are more view types, but they are only available in Odoo Enterprise Edition. Since our entire series of articles is based on the Community Edition, we cannot provide examples for these views:

- Dashboard uses subviews such as pivot tables and charts to display cumulative data
- Cohort is used to show how data changes over different periods of time
- Gantt chart displays date plan information, commonly used in project management
- grid organizes data into rows and columns for display

The official documentation provides a good reference to all views and available properties, so we won't repeat it here. We'll focus on providing some basic usage examples so you can get started with these views. This should provide a good foundation to then further explore all the features of each view.

> **Tip:** You can view other view types through community plugin modules. For web client plugins managed by OCA, please see the [GitHub repository](https://github.com/OCA/web). For example, the web_timeline module provides a timeline view type that can also display schedule information like a Gantt chart. It is the community version of the gantt view type.

### Activity View

The activity view type is a built-in summary board of planned activities that helps visualize active tasks. It is provided by the mail module, so you need to install the module before you can use this view type. To use this type, just add the activity view type to the list of views in the view_code attribute of the window action. The actual view definition is automatically generated, and we can also add it manually. The only option is to modify the string attribute, but it is not used in the UI.

For reference, the activity view definition looks like this:

```
<activity string="Activities"/>
```

### Calendar View

As the name suggests, this view type displays records in a calendar, which can be browsed by different time intervals: by month, by week, or by day. Here is the calendar view of our book loan, showing items on the calendar according to the request date:

```
    <record id="view_calendar_checkout" model="ir.ui.view">
        <field name="model">library.checkout</field>
        <field name="arch" type="xml">
            <calendar date_start="request_date"
                color="user_id">
                <field name="member_id" />
                <field name="stage_id" />
            </calendar>
        </field>
    </record>
```

Supplement: Please remember to add back the calendar type deleted above in the menu xml file

The basic calendar properties are:

- date_start is the start date field (required)
- date_end is the end date field (optional)
- date_delay is the number of days field, used instead of date_end
- all_day passes in a boolean field name to identify all-day activities. The duration is ignored for such activities.
- color is used to add color to a group of calendar items. Each distinct value will be assigned a color, and all its items will be displayed with the same color.
- mode is the default display mode of the calendar view, which can be day, week or month.

> ℹ️ **Changes in Odoo 11**
> The dipsplay calendar attribute was removed in Odoo 11. In previous versions, it was used to customize the format of the calendar item title text, for example display="[name], Stage [stage_id]".

![Odoo 12 Calendar View](http://alanhou.org/homepage/wp-content/uploads/2019/01/calendar-view.jpg)

### Pivot Table View

You can also view data through a pivot table, which is a dynamic analysis matrix. To do this, we use the pivot table view.

> ℹ️ **Changes in Odoo 9**
> Pivot tables already exist in Odoo 8 as a chart view feature. In Odoo 9, it becomes an independent view type. At the same time, the pivot table function is enhanced and the acquisition of pivot table data is optimized.

Data accumulation is only available for fields stored in the database. We will use the num_books field to show some statistics on the number of books borrowed. It is a calculated field and is not stored in the database yet. To use it in these views, you need to store it in the database first by adding the store=True attribute:

```
    num_books = fields.Integer(
        compute='_compute_num_books',
        store=True)
```

Use the following code to add a pivot table for book loans:

```
    <record id="view_pivot_checkout" model="ir.ui.view">
        <field name="model">library.checkout</field>
        <field name="arch" type="xml">
            <pivot>
                <field name="stage_id" type="col" />
                <field name="member_id" />
                <field name="request_date" interval="week" />
                <field name="num_books" type="measure" />
            </pivot>
        </field>
    </record>
```

Charts and pivot table views should contain Field elements describing axes and measures, and most of the properties are common to both:

- name identifies the field used in the diagram like other views
- type refers to how the field is used, row grouping (default), measure (measure) or column (for pivot tables only, for column grouping)
- interval is used for date fields and is a grouping interval for time data: by day, week, month, quarter or year

![Odoo 12 Pivot View](http://alanhou.org/homepage/wp-content/uploads/2019/01/pivot-view.jpg)

### Chart View

The chart view displays the accumulated data as a chart, which can be a bar chart, line chart, or pie chart. Let's add a chart view for book borrowing:

```
    <record id="view_graph_checkout" model="ir.ui.view">
        <field name="model">library.checkout</field>
        <field name="arch" type="xml">
            <graph type="bar">
                <field name="stage_id" />
                <field name="num_books" type="measure" />
            </graph>
        </field>
    </record>
```

The chart view element can have a type attribute with the values ​​bar (default), pie or line. For bar, an additional stacked="True" attribute can be used to make the bars stacked. The chart uses two type fields:

- type="row" is the default value, which sets the condition for adding values
- type="measure" is used for measure fields that are actual accumulated values

Chart and pivot table views should contain Field elements that describe the axes and measures to be used. Most of the properties in a chart view are also available in a pivot table view.

![Odoo 12 Graph View](http://alanhou.org/homepage/wp-content/uploads/2019/01/graph-view.jpg)

## Summarize

In this article we learned more about Odoo views for creating user interfaces. We took a deep dive into form views, then took an overview of other view types, including list views and search views. We also learned how to add dynamic behavior to view elements.

In the next article, we will learn about views that are not covered in this article: the kanban view and the template language it uses, QWeb.

 

☞☞☞Chapter 11 [Odoo 12 Development of Kanban View and User-side QWeb] (11.md)

 

## Further reading

The following are additional references and supplementary materials on the topics discussed in this article:

- Odoo official documentation
  - [有关actions](https://www.odoo.com/documentation/12.0/reference/actions.html)
  - [About views](https://www.odoo.com/documentation/12.0/reference/views.html)
- Font Awesome[icon index](https://fontawesome.com/v4.7.0/icons/)

 